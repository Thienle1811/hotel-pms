{% extends 'pms/base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
  .search-bar { margin-bottom: 20px; }
  .search-bar input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 300px; }
  .search-bar button { padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
  .search-bar button:hover { background-color: #0056b3; }
{% endblock %}

{% block content %}
  <h2>{{ page_title }}</h2>
  
  <div class="search-bar">
    <form method="GET">
      <input type="text" name="q" placeholder="Tìm kiếm theo Tên, CCCD hoặc SĐT..." value="{{ search_query|default:'' }}">
      <button type="submit">Tìm kiếm</button>
    </form>
  </div>

  <table>
    <thead>
      <tr>
        <th>Họ và Tên</th>
        <th>Mã số giấy tờ</th>
        <th>Biển số xe</th>
        <th>Loại giấy tờ</th>
        <th>Ngày sinh</th>
        <th>Địa chỉ thường trú</th>
        <th>Số điện thoại</th>
        <th style="text-align: center;">Hành động</th>
      </tr>
    </thead>
    <tbody>
      {% for guest in guests %}
      <tr>
        <td><strong>{{ guest.full_name }}</strong></td>
        <td>{{ guest.id_number }}</td>
        <td>{{ guest.license_plate|default:"---" }}</td>
        <td>{{ guest.get_id_type_display }}</td>
        <td>{{ guest.dob|date:"d/m/Y"|default:"---" }}</td>
        <td>{{ guest.address }}</td>
        <td>{{ guest.phone|default:"---" }}</td>
        
        <td style="text-align: center; white-space: nowrap;">
            <a href="{% url 'edit-guest' guest.id %}" style="color: #007bff; text-decoration: none; font-weight: bold; margin-right: 15px;">Sửa</a>
            <form action="{% url 'delete-guest' guest.id %}" method="POST" style="display: inline;" onsubmit="return confirm('CẢNH BÁO: Xóa khách hàng sẽ xóa luôn toàn bộ lịch sử đặt phòng của họ.\n\nBạn có chắc chắn muốn xóa {{ guest.full_name }} không?');">
                {% csrf_token %}
                <button type="submit" style="background: none; border: none; color: #dc3545; font-weight: bold; cursor: pointer; padding: 0; font-family: inherit; font-size: inherit;">Xóa</button>
            </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8">Không tìm thấy khách hàng nào.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}