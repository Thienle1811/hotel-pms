{% extends 'pms/base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
    /* KHU V·ª∞C 1: 3 √î TH·ªêNG K√ä */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
    .stat-card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; border-top: 5px solid #007bff; }
    .stat-card h3 { font-size: 36px; margin: 10px 0; color: #333; }
    .stat-card p { color: #666; font-size: 16px; margin: 0; text-transform: uppercase; font-weight: bold; }
    .card-revenue { border-top-color: #28a745; } 
    .card-guest { border-top-color: #17a2b8; }   
    .card-room { border-top-color: #dc3545; }     

    /* KHU V·ª∞C 2: TH·ªúI KH√ìA BI·ªÇU */
    .schedule-section { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow-x: auto; }
    
    .schedule-table { width: 100%; border-collapse: collapse; min-width: 800px; }
    .schedule-table th, .schedule-table td { border: 1px solid #dee2e6; padding: 10px; vertical-align: top; }
    .schedule-table th { background-color: #f8f9fa; text-align: center; color: #495057; font-weight: bold; }
    .schedule-table td { height: 100px; } /* Chi·ªÅu cao t·ªëi thi·ªÉu cho √¥ */

    /* Style cho th·∫ª nh√¢n vi√™n trong √¥ */
    .staff-tag { 
        display: block; 
        background-color: #e3f2fd; 
        color: #0d47a1; 
        padding: 4px 6px; 
        border-radius: 4px; 
        margin-bottom: 4px; 
        font-size: 0.85em; 
        border-left: 3px solid #2196f3;
    }
    .role-label { font-size: 0.8em; color: #666; font-style: italic; }
    
    .shift-header { background-color: #e9ecef; font-weight: bold; text-align: center; vertical-align: middle; width: 100px;}
    
    .today-col { background-color: #fff3cd; border: 2px solid #ffc107; } /* Highlight ng√†y h√¥m nay */
{% endblock %}

{% block content %}
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 style="margin: 0;">B√°o c√°o T·ªïng quan (Th√°ng {{ today|date:"m" }})</h2>
    </div>

    <div class="stats-grid">
        <div class="stat-card card-revenue">
            <p>üí∞ T·ªïng Doanh Thu Th√°ng</p>
            <h3>{{ revenue_month|floatformat:0 }} ƒë</h3>
        </div>
        <div class="stat-card card-guest">
            <p>üë• S·ªë Kh√°ch Trong Th√°ng</p>
            <h3>{{ guest_month_count }}</h3>
        </div>
        <div class="stat-card card-room">
            <p>üîë Ph√≤ng ƒêang S·ª≠ D·ª•ng</p>
            <h3>{{ occupied_count }} / 7</h3>
        </div>
    </div>

    <div class="schedule-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0;">üìÖ L·ªãch l√†m vi·ªác Tu·∫ßn n√†y</h3>
            <a href="{% url 'add-staff-schedule' %}" class="btn-action btn-green" style="padding: 8px 15px; font-size: 14px;">
                + Th√™m l·ªãch l√†m vi·ªác
            </a>
        </div>
        
        <table class="schedule-table">
            <thead>
                <tr>
                    <th style="width: 100px;">Ca / Ng√†y</th>
                    {% for day in week_dates %}
                        <th class="{% if day == today %}today-col{% endif %}">
                            {{ day|date:"l" }}<br>
                            <span style="font-size: 0.9em; font-weight: normal;">{{ day|date:"d/m" }}</span>
                        </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in timetable %}
                <tr>
                    <td class="shift-header">{{ row.label }}</td>
                    
                    {% for cell_staffs in row.days %}
                        <td>
                            {% for staff in cell_staffs %}
                                <div class="staff-tag">
                                    <strong>{{ staff.staff_name }}</strong><br>
                                    <span class="role-label">{{ staff.get_role_display }}</span>
                                </div>
                            {% empty %}
                                <span style="color: #ccc; font-size: 0.8em;">-</span>
                            {% endfor %}
                        </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <p style="margin-top: 10px; font-size: 0.9em; color: #666; font-style: italic;">* C·ªôt m√†u v√†ng l√† ng√†y h√¥m nay.</p>
    </div>
{% endblock %}