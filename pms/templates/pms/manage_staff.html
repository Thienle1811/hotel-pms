{% extends 'pms/base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
  .form-container { background: white; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #ddd; }
  .form-row { display: flex; gap: 15px; flex-wrap: wrap; }
  .form-group { flex: 1; min-width: 200px; margin-bottom: 15px; }
  .form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
  .form-group input, .form-group select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
  .role-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.85em; font-weight: bold; }
  .badge-admin { background-color: #6f42c1; color: white; } /* Tím */
  .badge-staff { background-color: #17a2b8; color: white; } /* Xanh */
{% endblock %}

{% block content %}
    <h2>{{ page_title }}</h2>

    <div class="form-container">
        <h3 style="margin-top: 0;">+ Tạo Tài khoản mới</h3>
        <form method="POST">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label>Họ:</label> {{ form.first_name }}
                </div>
                <div class="form-group">
                    <label>Tên:</label> {{ form.last_name }}
                </div>
                <div class="form-group">
                    <label>Email:</label> {{ form.email }}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Tên đăng nhập (*):</label> {{ form.username }}
                </div>
                <div class="form-group">
                    <label>Mật khẩu (*):</label> {{ form.password }}
                </div>
                <div class="form-group">
                    <label>Phân quyền (*):</label> {{ form.role }}
                </div>
            </div>
            <button type="submit" class="btn-action btn-green" style="padding: 10px 20px; border: none; cursor: pointer;">Tạo Nhân viên</button>
        </form>
    </div>

    <h3>Danh sách Tài khoản</h3>
    <table>
        <thead>
            <tr>
                <th>STT</th>
                <th>Tên đăng nhập</th>
                <th>Họ và Tên</th>
                <th>Vai trò</th>
                <th>Ngày tạo</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            {% for staff in staff_list %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td><strong>{{ staff.username }}</strong></td>
                <td>{{ staff.last_name }} {{ staff.first_name }}</td>
                <td>
                    {% if staff.is_superuser %}
                        <span class="role-badge badge-admin">Quản lý (Admin)</span>
                    {% else %}
                        <span class="role-badge badge-staff">Lễ tân</span>
                    {% endif %}
                </td>
                <td>{{ staff.date_joined|date:"d/m/Y" }}</td>
                <td>
                    {% if staff != user %}
                    <form action="{% url 'delete-staff' staff.id %}" method="POST" onsubmit="return confirm('Xóa tài khoản này?');">
                        {% csrf_token %}
                        <button type="submit" style="color: red; border: none; background: none; cursor: pointer; font-weight: bold;">Xóa</button>
                    </form>
                    {% else %}
                        <span style="color: #ccc;">(Bạn)</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}